var rt=Object.defineProperty;var dt=(n,t,e)=>t in n?rt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var C=(n,t,e)=>(dt(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();var A={};"global"in A||(typeof window<"u"?A.global=window:typeof global<"u"?A.global=global:A.global={});"document"in A||typeof document<"u"&&(A.document=document);var c={...A,delegatedEvents:new Set};function J(n,t){return!t||n.length!==t.length?!1:n.every((e,i)=>!(e instanceof Object)&&t[i]===e)}var q={Comp:0,For:1,Cond:2,Env:3,Exp:4,Snippet:5,Try:6},_=class{constructor(n){C(this,"_$dlNodeType");this._$dlNodeType=n}get _$el(){return _.toEls(this._$nodes)}static toEls(n){const t=[];return this.loopShallowEls(n,e=>{t.push(e)}),t}static loopShallowEls(n,t){const e=[...n].reverse();for(;e.length>0;){const i=e.pop();"_$dlNodeType"in i?i._$nodes&&e.push(...[...i._$nodes].reverse()):t(i)}}static addParentEl(n,t){n.forEach(e=>{"_$dlNodeType"in e&&(e._$parentEl=t,e._$nodes&&_.addParentEl(e._$nodes,t))})}static getFlowIndexFromNodes(n,t){let e=0;const i=[...n].reverse();for(;i.length>0;){const o=i.pop();if(o===t)break;"_$dlNodeType"in o?o._$nodes&&i.push(...[...o._$nodes].reverse()):e++}return e}static appendNodesWithSibling(n,t,e){return e?this.insertNodesBefore(n,t,e):this.appendNodes(n,t)}static appendNodesWithIndex(n,t,e,i){return i=i??t.childNodes.length,i!==e?this.insertNodesBefore(n,t,t.childNodes[e]):this.appendNodes(n,t)}static insertNodesBefore(n,t,e){let i=0;return this.loopShallowEls(n,o=>{t.insertBefore(o,e),i++}),i}static appendNodes(n,t){let e=0;return this.loopShallowEls(n,i=>{t.appendChild(i),e++}),e}static addWillUnmount(n,t){const e=c.global.WillUnmountStore,i=e[e.length-1];i&&i.push(t.bind(null,n))}static addDidUnmount(n,t){const e=c.global.DidUnmountStore,i=e[e.length-1];i&&i.push(t.bind(null,n))}static addDidMount(n,t){c.global.DidMountStore||(c.global.DidMountStore=[]),c.global.DidMountStore.push(t.bind(null,n))}static runDidMount(){const n=c.global.DidMountStore;if(!(!n||n.length===0)){for(let t=n.length-1;t>=0;t--)n[t]();c.global.DidMountStore=[]}}};function k(n,t,e){if(e.length===0)return!1;const i=`$${t}`;return J(e,n[i])?!0:(n[i]=e,!1)}function tt(n,t){Object.entries(t).forEach(([e,i])=>{e.startsWith("--")?n.style.setProperty(e,i):n.style[e]=i})}function et(n,t){Object.assign(n.dataset,t)}function y(n,t,e,i){k(n,t,i)||(n[t]=e())}function lt(n,t){Object.entries(t).forEach(([e,i])=>{if(e==="style")return tt(n,i);if(e==="dataset")return et(n,i);y(n,e,()=>i,[])})}function nt(n,t,e,i){k(n,t,i)||n.setAttribute(t,e())}function ut(n,t){Object.entries(t).forEach(([e,i])=>{nt(n,e,()=>i,[])})}function at(n,t,e){const i=n[`$on${t}`];i&&n.removeEventListener(t,i),n.addEventListener(t,e),n[`$on${t}`]=e}function ht(n){const t=`$$${n.type}`;for(const e of n.composedPath())if(e[t]&&e[t](n),n.cancelBubble)return}function O(n,t,e){n[`$$${t}`]!==e&&(n[`$$${t}`]=e,c.delegatedEvents.has(t)||(c.delegatedEvents.add(t),c.document.addEventListener(t,ht)))}function f(n){return c.document.createElement(n)}function D(n,t,e){n._$nodes||(n._$nodes=Array.from(n.childNodes)),n._$nodes.splice(e,0,t);const i=_.getFlowIndexFromNodes(n._$nodes,t);_.appendNodesWithIndex([t],n,i),_.addParentEl([t],n)}function ct(n,t,e,i){if(t==="style")return tt(n,e());if(t==="dataset")return et(n,e());if(t!=="element"){if(t==="prop")return lt(n,e());if(t==="attr")return ut(n,e());if(t==="innerHTML")return y(n,"innerHTML",e,i);if(t==="textContent")return y(n,"textContent",e,i);if(t!=="forwardProp"){if(t.startsWith("on"))return at(n,t.slice(2).toLowerCase(),e());nt(n,t,e,i)}}}var pt=Promise.resolve();function ft(n){pt.then(n)}var mt=class extends _{constructor(){super(q.Comp)}setUpdateFunc({updateState:n,updateProp:t,updateContext:e,getUpdateViews:i,didUnmount:o,willUnmount:s,didMount:a}){this.updateState=n,this._$updateProp=t,e&&(this.updateContext=e),this.getUpdateViews=i,this.didUnmount=o,this.willUnmount=s,this.didMount=a}updateProp(...n){this._$updateProp(...n)}init(){this._$notInitd=!0;const n=()=>{if(this._$callUpdatesBeforeInit(),this.didMount&&_.addDidMount(this,this.didMount.bind(this)),this.willUnmount&&_.addWillUnmount(this,this.willUnmount.bind(this)),_.addDidUnmount(this,this._$setUnmounted.bind(this)),this.didUnmount&&_.addDidUnmount(this,this.didUnmount.bind(this)),this.getUpdateViews){const t=this.getUpdateViews();if(Array.isArray(t)){const[e,i]=t;this.updateView=i,this._$nodes=e}else this.updateView=t}};return this._$catchable?(this._$catchable(n)(),this._$update&&(this._$update=this._$catchable(this._$update.bind(this))),this.updateDerived=this._$catchable(this.updateDerived.bind(this)),delete this._$catchable):n(),this}_$setUnmounted(){this._$unmounted=!0}_$callUpdatesBeforeInit(){this.updateState(-1),delete this._$notInitd}_$setPropToForward(n,t,e){this._$forwardPropsSet.forEach(i=>{if(i._$dlNodeType===q.Comp){i._$setProp(n,()=>t,e);return}i instanceof HTMLElement&&ct(i,n,()=>t,e)})}_$setForwardProp(n,t,e){const i="_$notInitd"in this;if(!i&&this._$cache(n,e))return;const o=t();n==="_$content"&&this._$contentKey&&(this[this._$contentKey]=o,this.updateDerived(this._$contentKey)),this[n]=o,this.updateDerived(n),i?this._$forwardPropsId.push(n):this._$setPropToForward(n,o,e)}_$cache(n,t){if(!t||!t.length)return!1;const e=`$cc$${n}`;return J(t,this[e])?!0:(this[e]=t,!1)}_$setContent(n,t){if("_$forwardProps"in this)return this._$setForwardProp("_$content",n,t);const e=this._$contentKey;e&&(this._$cache(e,t)||(this[e]=n(),this.updateDerived(e)))}_$setProp(n,t,e){this._$cache(n,e)||(this[n]=t(),this.updateProp(n,this[n]))}_$setProps(n,t){if(this._$cache("props",t))return;const e=n();e&&Object.entries(e).forEach(([i,o])=>{this._$setProp(i,()=>o,[])})}_$updateContext(n,t,e){this.updateContext&&this.updateContext(e,n,t)}_$ud(n,t){return this.updateDerived(t),n}updateDerived(n,t){"_$notInitd"in this||(this.updateState(t),this._$updateView(t))}_$updateView(n){n&&("_$depNumsToUpdate"in this?this._$depNumsToUpdate.push(n):(this._$depNumsToUpdate=[n],ft(()=>{if(this._$unmounted)return;const t=this._$depNumsToUpdate;if(t.length>0){const e=t.reduce((i,o)=>i|o,0);this.updateView(e)}delete this._$depNumsToUpdate})))}};function Q(n){for(const[t,e]of n.entries())e.replaceContextValue()}var it=class extends _{constructor(n){super(n);const t=c.global.envNodeMap;t&&(this.savedEnvNodes=new Map([...t]))}initNewNodes(n){_.addParentEl(n,this._$parentEl)}geneNewNodesInEnv(n){if(!this.savedEnvNodes){const i=n();return this.initNewNodes(i),i}const t=c.global.envNodeMap;Q(this.savedEnvNodes);const e=n();return Q(t),this.initNewNodes(e),e}initUnmountStore(){c.global.WillUnmountStore.push([]),c.global.DidUnmountStore.push([])}removeNodes(n){_.loopShallowEls(n,t=>{this._$parentEl.removeChild(t)})}},p=class extends it{constructor(t,e,i,o){super(q.For);C(this,"array");C(this,"nodeFunc");C(this,"depNum");C(this,"nodesMap",new Map);C(this,"updateArr",[]);this.array=[...t],this.keys=i,this.depNum=e,this.addNodeFunc(o)}get _$nodes(){var e;const t=[];for(let i=0;i<this.array.length;i++)t.push(...this.nodesMap.get(((e=this.keys)==null?void 0:e[i])??i));return t}addNodeFunc(t){this.nodeFunc=t,this.array.forEach((e,i)=>{var a;this.initUnmountStore();const o=((a=this.keys)==null?void 0:a[i])??i,s=t(e,i,this.updateArr);this.nodesMap.set(o,s),this.setUnmountMap(o)}),p.addWillUnmount(this,this.runAllWillUnmount.bind(this)),p.addDidUnmount(this,this.runAllDidUnmount.bind(this))}updateItem(t,e,i){var o,s;(s=(o=this.updateArr)[t])==null||s.call(o,i??this.depNum,e[t])}updateItems(t){for(let e=0;e<this.array.length;e++)this.updateItem(e,this.array,t)}update(t){~this.depNum&t&&this.updateItems(t)}updateArray(t,e){if(e){this.updateWithKey(t,e);return}this.updateWithOutKey(t)}getNewNodes(t,e,i,o){this.initUnmountStore();const s=this.geneNewNodesInEnv(()=>this.nodeFunc(i[t],t,o??this.updateArr));return this.setUnmountMap(e),this.nodesMap.set(e,s),s}setUnmountMap(t){const e=c.global.WillUnmountStore.pop();e&&e.length>0&&(this.willUnmountMap||(this.willUnmountMap=new Map),this.willUnmountMap.set(t,e));const i=c.global.DidUnmountStore.pop();i&&i.length>0&&(this.didUnmountMap||(this.didUnmountMap=new Map),this.didUnmountMap.set(t,i))}runAllWillUnmount(){!this.willUnmountMap||this.willUnmountMap.size===0||(this.willUnmountMap.forEach(t=>{var e;for(let i=0;i<t.length;i++)(e=t[i])==null||e.call(t)}),this.willUnmountMap.clear())}runAllDidUnmount(){!this.didUnmountMap||this.didUnmountMap.size===0||(this.didUnmountMap.forEach(t=>{var e;for(let i=t.length-1;i>=0;i--)(e=t[i])==null||e.call(t)}),this.didUnmountMap.clear())}runWillUnmount(t){var i;if(!this.willUnmountMap||this.willUnmountMap.size===0)return;const e=this.willUnmountMap.get(t);if(e){for(let o=0;o<e.length;o++)(i=e[o])==null||i.call(e);this.willUnmountMap.delete(t)}}runDidUnmount(t){var i;if(!this.didUnmountMap||this.didUnmountMap.size===0)return;const e=this.didUnmountMap.get(t);if(e){for(let o=e.length-1;o>=0;o--)(i=e[o])==null||i.call(e);this.didUnmountMap.delete(t)}}removeNodes(t,e){this.runWillUnmount(e),super.removeNodes(t),this.runDidUnmount(e),this.nodesMap.delete(e)}updateWithOutKey(t){const e=this.array.length,i=t.length;if(e===i){for(let s=0;s<this.array.length;s++)this.updateItem(s,t);this.array=[...t];return}const o=this._$parentEl;if(e<i){let s=p.getFlowIndexFromNodes(o._$nodes,this);const a=o.childNodes.length;for(let d=0;d<i;d++){if(d<e){s+=p.getFlowIndexFromNodes(this.nodesMap.get(d)),this.updateItem(d,t);continue}const m=this.getNewNodes(d,d,t);p.appendNodesWithIndex(m,o,s,a)}p.runDidMount(),this.array=[...t];return}for(let s=0;s<i;s++)this.updateItem(s,t);for(let s=i;s<e;s++){const a=this.nodesMap.get(s);this.removeNodes(a,s)}this.updateArr.splice(i,e-i),this.array=[...t]}updateWithKey(t,e){var h;if(e.length!==new Set(e).size)throw new Error("Inula-Next: Duplicate keys in for loop are not allowed");const i=this.keys;if(this.keys=e,p.arrayEqual(i,this.keys)){for(let r=0;r<t.length;r++)this.updateItem(r,t);this.array=[...t];return}const o=this._$parentEl;if(this.keys.length===0){const r=o._$nodes??[];if(r.length===1&&r[0]===this)this.runAllWillUnmount(),o.innerHTML="",this.runAllDidUnmount();else for(let l=0;l<i.length;l++){const g=i[l];this.removeNodes(this.nodesMap.get(g),g)}this.nodesMap.clear(),this.updateArr=[],this.array=[];return}const s=p.getFlowIndexFromNodes(o._$nodes,this);if(i.length===0){const r=o.childNodes[s];for(let l=0;l<this.keys.length;l++){const g=this.getNewNodes(l,this.keys[l],t);p.appendNodesWithSibling(g,o,r)}p.runDidMount(),this.array=[...t];return}const a=[],d=[];for(let r=0;r<i.length;r++){const l=i[r];if(this.keys.includes(l)){a.push(l),d.push(this.updateArr[r]);continue}this.removeNodes(this.nodesMap.get(l),l)}let m=o.childNodes.length,$=s;for(let r=0;r<this.keys.length;r++){const l=this.keys[r],g=a.indexOf(l);if(g!==-1){$+=p.getFlowIndexFromNodes(this.nodesMap.get(l)),(h=d[g])==null||h.call(d,this.depNum,t[r]);continue}d.splice(r,0,null);const E=this.getNewNodes(r,l,t,d);a.splice(r,0,l);const T=p.appendNodesWithIndex(E,o,$,m);$+=T,m+=T}if(p.runDidMount(),p.arrayEqual(this.keys,a)){this.array=[...t],this.updateArr=d;return}$=s;const W=new Map;for(let r=0;r<this.keys.length;r++){const l=this.keys[r],g=a.indexOf(l),E=W.get(l);if(E){const I=p.getFlowIndexFromNodes(E),F=p.toEls(E).pop(),v=o.childNodes[$+I];F!==v&&F.nextSibling!==v&&p.insertNodesBefore(E,o,v),$+=I,delete W[r]}else if(g===r){$+=p.getFlowIndexFromNodes(this.nodesMap.get(l));continue}else{const I=a[r];W.set(I,this.nodesMap.get(I));const F=this.nodesMap.get(l),v=p.toEls(F).pop(),H=o.childNodes[$];v!==H&&v.nextSibling!==H&&($+=p.insertNodesBefore(F,o,H))}const T=a[r];a[r]=a[g],a[g]=T;const z=d[r];d[r]=d[g],d[g]=z}this.array=[...t],this.updateArr=d}static arrayEqual(t,e){return t.length!==e.length?!1:t.every((i,o)=>i===e[o])}},$t=class extends it{constructor(){super(...arguments);C(this,"willUnmountFuncs",[]);C(this,"didUnmountFuncs",[])}setUnmountFuncs(){this.willUnmountFuncs=c.global.WillUnmountStore.pop(),this.didUnmountFuncs=c.global.DidUnmountStore.pop()}runWillUnmount(){for(let t=0;t<this.willUnmountFuncs.length;t++)this.willUnmountFuncs[t]()}runDidUnmount(){for(let t=this.didUnmountFuncs.length-1;t>=0;t--)this.didUnmountFuncs[t]()}removeNodes(t){this.runWillUnmount(),super.removeNodes(t),this.runDidUnmount()}geneNewNodesInEnv(t){this.initUnmountStore();const e=super.geneNewNodesInEnv(t);return this.setUnmountFuncs(),e}},P=class extends $t{constructor(n,t){super(q.Exp),this.initUnmountStore(),this._$nodes=P.formatNodes(n),this.setUnmountFuncs(),this.deps=this.parseDeps(t),P.addWillUnmount(this,this.runWillUnmount.bind(this)),P.addDidUnmount(this,this.runDidUnmount.bind(this))}parseDeps(n){return n.map(t=>{var e;return(e=t==null?void 0:t.prototype)!=null&&e._$init?t.toString():t!=null&&t.propViewFunc?t.propViewFunc.toString():t})}cache(n){return!n||!n.length?!1:(n=this.parseDeps(n),J(n,this.deps)?!0:(this.deps=n,!1))}update(n,t){if(this.cache(t))return;this.removeNodes(this._$nodes);const e=this.geneNewNodesInEnv(()=>P.formatNodes(n()));if(e.length===0){this._$nodes=[];return}const i=this._$parentEl,o=P.getFlowIndexFromNodes(i._$nodes,this),s=i.childNodes[o];P.appendNodesWithSibling(e,i,s),P.runDidMount(),this._$nodes=e}static formatNodes(n){return Array.isArray(n)||(n=[n]),n.flat(1).filter(t=>t!=null&&typeof t!="boolean").map(t=>typeof t=="string"||typeof t=="number"||typeof t=="bigint"?c.document.createTextNode(`${t}`):"propViewFunc"in t?t.build():t).flat(1)}};function gt(){c.global.WillUnmountStore=[],c.global.DidUnmountStore=[]}function Nt(n,t){let e=t;if(typeof t=="string"){const o=c.document.getElementById(t);if(o)e=o;else throw new Error(`Inula-Next: Element with id ${t} not found`)}gt(),e.innerHTML="";const i=L(n);D(e,i,0),_.runDidMount()}var B=null;function L(n,t={}){return bt(()=>new mt,n,t)}function bt(n,t,e){const i=n();let o=B;try{B=i,t(e)}catch(s){throw s}finally{B=o}return i}function ot(n){if(!B)throw new Error("Should not call createComponent outside the component function");return B.setUpdateFunc(n),B}let wt=1;const X=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],Y=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],Z=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"];function R(n){return Math.round(Math.random()*1e3)%n}function G(n){const t=new Array(n);for(let e=0;e<n;e++)t[e]={id:wt++,label:`${X[R(X.length)]} ${Y[R(Y.length)]} ${Z[R(Z.length)]}`};return t}function V({id:n,text:t,fn:e}){let i,o=n,s=t,a=e;return i=ot({updateState:d=>{},updateProp:(d,m)=>{d==="fn"?i.updateDerived(a=m,4):d==="text"?i.updateDerived(s=m,2):d==="id"&&i.updateDerived(o=m,1)},getUpdateViews:()=>{let d,m,$;return d=(()=>{let h,r;return h=f("div"),h.setAttribute("class","col-sm-6 smallpad"),r=f("button"),r.setAttribute("class","btn btn-primary btn-block"),r.type="button",h.appendChild(r),h})().cloneNode(!0),m=d.firstChild,y(m,"id",()=>o,[o]),O(m,"click",a),$=new P(s,[s]),D(m,$,0),[[d],h=>(h&1&&m&&y(m,"id",()=>o,[o]),h&2&&$&&$.update(()=>s,[s]),h&4&&m&&O(m,"click",a),[d])]}}),i.init()}function Ut(){let n,t=[],e=null;function i(){n.updateDerived(t=G(1e3),1)}function o(){n.updateDerived(t=G(1e4),1)}function s(){n.updateDerived(t.push(...G(1e3)),1)}function a(){for(let h=0;h<t.length;h+=10)n.updateDerived(t[h].label+=" !!!",1)}function d(){t.length>998&&n.updateDerived([t[1],t[998]]=[t[998],t[1]],1)}function m(){n.updateDerived(t=[],1)}function $(h){n.updateDerived(t=t.filter(r=>r.id!==h),1)}function W(h){n.updateDerived(e=h,2)}return n=ot({updateState:h=>{},getUpdateViews:()=>{let h,r,l,g,E,T,z,I,F,v;const H=(()=>{let u,U,x,S,b,w,N,M,j,K;return u=f("div"),u.setAttribute("class","container"),U=f("div"),U.setAttribute("class","jumbotron"),x=f("div"),x.setAttribute("class","row"),S=f("div"),S.setAttribute("class","col-md-6"),b=f("h1"),b.textContent="Inula-next Keyed",S.appendChild(b),x.appendChild(S),w=f("div"),w.setAttribute("class","col-md-6"),N=f("div"),N.setAttribute("class","row"),w.appendChild(N),x.appendChild(w),U.appendChild(x),u.appendChild(U),M=f("table"),M.setAttribute("class","table table-hover table-striped test-data"),j=f("tbody"),M.appendChild(j),u.appendChild(M),K=f("span"),K.setAttribute("class","preloadicon glyphicon glyphicon-remove"),K.setAttribute("aria-hidden","true"),u.appendChild(K),u})(),st=(()=>{let u,U,x,S,b,w,N,M;return u=f("tr"),U=f("td"),U.className="col-md-1",u.appendChild(U),x=f("td"),x.className="col-md-4",S=f("a"),x.appendChild(S),u.appendChild(x),b=f("td"),b.className="col-md-1",w=f("a"),N=f("span"),N.className="glyphicon glyphicon-remove",N.setAttribute("aria-hidden","true"),w.appendChild(N),b.appendChild(w),u.appendChild(b),M=f("td"),M.className="col-md-6",u.appendChild(M),u})();return h=H.cloneNode(!0),r=h.firstChild.nextSibling.firstChild,l=h.firstChild.firstChild.firstChild.nextSibling.firstChild,g=L(V,{id:"run",text:"Create 1,000 rows",fn:i}),D(l,g,0),E=L(V,{id:"runlots",text:"Create 10,000 rows",fn:o}),D(l,E,1),T=L(V,{id:"add",text:"Append 1,000 rows",fn:s}),D(l,T,2),z=L(V,{id:"update",text:"Update every 10th row",fn:a}),D(l,z,3),I=L(V,{id:"clear",text:"Clear",fn:m}),D(l,I,4),F=L(V,{id:"swaprows",text:"Swap Rows",fn:d}),D(l,F,5),v=new p(t,1,null,({id:u,label:U},x,S)=>{let b,w,N,M;return S[x]=(j,K)=>{({id:u,label:U}=K),j&1&&(w&&y(w,"textContent",()=>u,[u]),N&&O(N,"click",W.bind(this,u)),N&&y(N,"textContent",()=>U,[U]),M&&O(M,"click",$.bind(this,u))),j&3&&b&&y(b,"className",()=>e===u?"danger":"",[e,u])},b=st.cloneNode(!0),w=b.firstChild,N=w.nextSibling.firstChild,M=w.nextSibling.nextSibling.firstChild,y(b,"className",()=>e===u?"danger":"",[e,u]),y(w,"textContent",()=>u,[u]),O(N,"click",W.bind(this,u)),y(N,"textContent",()=>U,[U]),O(M,"click",$.bind(this,u)),[b]}),D(r,v,0),[[h],u=>(u&1&&v&&v.updateArray(t,null),v&&v.update(u),[h])]}}),n.init()}Nt(Ut,"main");
